<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RF – Resumo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --rf-yellow:#ffd600;
  --rf-yellow-strong:#ffb800;
  --rf-radius:26px;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

body.dark{
  background: radial-gradient(circle at top,#1c1c1c 0%,#000 70%);
  color:#fff;
}

.header{
  padding:22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(180deg,#000,#111);
  color:#fff;
}

.logo{
  font-weight:900;
  font-size:18px;
}

.container{
  padding:30px 25px 120px;
  max-width:420px;
  margin:auto;
}

.card{
  background:#fff;
  color:#000;
  border-radius:var(--rf-radius);
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 30px 60px rgba(0,0,0,.6);
  display:flex;
  flex-direction:column;
  gap:14px;
}

.card h3{
  font-size:16px;
  font-weight:800;
}

.route-line{
  font-size:14px;
}

.route-line span{
  color:#666;
}

textarea{
  width:100%;
  border-radius:14px;
  padding:12px;
  border:1px solid #ddd;
  resize:none;
  height:90px;
}

.categoria{
  display:flex;
  gap:10px;
}

.cat-btn{
  flex:1;
  padding:14px;
  border-radius:14px;
  border:2px solid #ddd;
  cursor:pointer;
  text-align:center;
  font-weight:600;
  transition:.2s;
}

.cat-btn.active{
  border-color:var(--rf-yellow-strong);
  background:rgba(255,214,0,.2);
}

.linha{
  display:flex;
  justify-content:space-between;
  font-size:14px;
}

.total{
  font-size:18px;
  font-weight:900;
  color:var(--rf-yellow-strong);
  margin-top:8px;
}

.footer{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#0f0f0f;
  padding:15px 20px;
  box-shadow:0 -8px 25px rgba(0,0,0,.6);
}

.footer-content{
  max-width:420px;
  margin:auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.footer button{
  padding:12px 28px;
  border:none;
  border-radius:30px;
  background:var(--rf-yellow);
  font-weight:700;
  cursor:pointer;
}
.valor-final{
  font-size:20px;
  font-weight:900;
  color:var(--rf-yellow);
}
</style>
</head>

<body class="dark">

<header class="header">
  <div class="logo">RESUMO DA VIAGEM</div>
</header>

<div class="container">

  <div class="card">
    <h3>Rota</h3>
    <div id="rota"></div>
  </div>

  <div class="card">
    <h3>Observação ao motorista</h3>
    <textarea id="observacao" placeholder="Ex: excesso de pessoas, mala grande, referência..."></textarea>
  </div>

  <div class="card">
    <h3>Categoria</h3>
    <div class="categoria">
      <div class="cat-btn active" id="cat4">Driver 4 Lugares</div>
      <div class="cat-btn" id="cat6">Driver 6 Lugares (+50%)</div>
    </div>
  </div>

  <div class="card">
    <h3>Detalhamento</h3>
    <div id="detalhamento"></div>
  </div>

</div>

<div class="footer">
  <div class="footer-content">
    <div class="valor-final" id="valorFinal">R$ 0,00</div>
    <button onclick="confirmar()">Solicitar</button>
  </div>
</div>

<script>

const corrida = JSON.parse(localStorage.getItem("rf_corrida_temp"));
if(!corrida) window.location.href="home.html";

let { origem, parada, destino, desvioRota, mercado, valor } = corrida;

let categoriaMultiplicador = 1;

function montarRota(){
  let html = `
    <div class="route-line"><span>Origem:</span> ${origem}</div>
  `;

  if(parada){
    html += `<div class="route-line"><span>Parada:</span> ${parada}</div>`;
  }

  html += `<div class="route-line"><span>Destino:</span> ${destino}</div>`;

  document.getElementById("rota").innerHTML = html;
}

function calcularAdicionalNoturno(base){

  const agora = new Date();
  const hora = agora.getHours() + (agora.getMinutes()/60);

  if(hora >= 22.5){

    if(base <= 24.99){
      return 4.99;
    }else{
      return base * 0.35;
    }
  }

  return 0;
}

function calcular(){

  let base = parseFloat(valor);
  let detalhamento = "";

  detalhamento += `<div class="linha"><span>Base</span><span>R$ ${base.toFixed(2)}</span></div>`;

  const adicionalNoturno = calcularAdicionalNoturno(base);

  if(adicionalNoturno > 0){
    detalhamento += `<div class="linha"><span>Adicional Noturno</span><span>R$ ${adicionalNoturno.toFixed(2)}</span></div>`;
    base += adicionalNoturno;
  }

  if(desvioRota){
    detalhamento += `<div class="linha"><span>Desvio simples</span><span>R$ 5,00</span></div>`;
    base += 5;
  }

  if(mercado){
    detalhamento += `<div class="linha"><span>Saída mercado</span><span>R$ 3,89</span></div>`;
    base += 3.89;
  }

  if(categoriaMultiplicador > 1){
    const acrescimo = base * 0.5;
    detalhamento += `<div class="linha"><span>6 Lugares (+50%)</span><span>R$ ${acrescimo.toFixed(2)}</span></div>`;
    base += acrescimo;
  }

  detalhamento += `<div class="linha total"><span>Total</span><span>R$ ${base.toFixed(2)}</span></div>`;

  document.getElementById("detalhamento").innerHTML = detalhamento;
  document.getElementById("valorFinal").innerText = "R$ "+base.toFixed(2);

  localStorage.setItem("rf_total_final", base.toFixed(2));
}

document.getElementById("cat4").onclick=()=>{
  categoriaMultiplicador=1;
  document.getElementById("cat4").classList.add("active");
  document.getElementById("cat6").classList.remove("active");
  calcular();
};

document.getElementById("cat6").onclick=()=>{
  categoriaMultiplicador=1.5;
  document.getElementById("cat6").classList.add("active");
  document.getElementById("cat4").classList.remove("active");
  calcular();
};

function confirmar(){

  const dadosFinal = {
    ...corrida,
    categoria: categoriaMultiplicador === 1 ? "Driver 4" : "Driver 6",
    observacao: document.getElementById("observacao").value,
    total: localStorage.getItem("rf_total_final")
  };

  localStorage.setItem("rf_corrida_confirmada", JSON.stringify(dadosFinal));

  window.location.href="procurando.html";
}

montarRota();
calcular();

</script>

</body>
</html>